# Requires window.shuffle
window.Abletech ||= {}
class Abletech.Polaroids
  'use strict'

  constructor: (elemID) ->
    @polaroidContainer = document.getElementById(elemID)

  polaroidContainer: null
  polaroids: [
    {
      u: '<%= image_path('team_snow.jpg') %>',
      a: 'Playing with the left-over snow whilst on a hike around Mount Cheeseman',
      c: 'Rails Camp at Mt. Cheeseman near Christchurch.'
    },{
      u: '<%= image_path('team_cycling.jpg') %>',
      a: 'Abletech, Kiwibank and HyTech team members pose for a photo next to the Brooklyn wind turbine, overlooking Wellington.',
      c: 'Abletech joined with Kiwibank and HyTech for a ride in Brooklyn.'
    },{
      u: '<%= image_path('team_coffee.jpg') %>',
      a: 'Impressive latte art by Jordan',
      c: 'Jordan perfects his coffee.'
    },{
      u: '<%= image_path('team_brewing.jpg') %>',
      a: 'Kendall and Tracey pose next to the brewing equipment',
      c: 'Serious business: brewing, bottling.'
    },{
      u: '<%= image_path('team_harbour_bridge.jpg') %>',
      a: 'The harbour bridge looms overhead while the Sydney Opera House is visible across the bay.',
      c: 'Ruby Conference in Sydney, Australia.'
    },{
      u: '<%= image_path('team_mountain_biking.jpg') %>',
      a: 'Carlâ€™s bike stands propped up against a tree in the middle of the bush',
      c: 'Mountain biking in the bush.'
    }
  ]

  clearPolaroids: =>
    @polaroidContainer.innerHTML = ''

  stackPolaroids: =>
    shuffledPolaroids = window.shuffle(@polaroids)
    for polaroid in shuffledPolaroids
      figure = document.createElement('figure')
      img = document.createElement('img')
      figcaption = document.createElement('figcaption')
      figure.className = 'figure figure_polaroid'
      img.alt = polaroid.a
      img.src = polaroid.u
      figure.appendChild(img)
      figcaption.innerHTML = polaroid.c
      figure.appendChild(figcaption)
      @polaroidContainer.appendChild(figure)

  bindPolaroidClick: =>
    @polaroidContainer.addEventListener 'click', (e) ->
      e.preventDefault()
      firstFigure = document.querySelector('#team_activities .figure:first-child')
      firstFigure.classList.add('swipe')
      setTimeout( () ->
        firstFigure.classList.remove('swipe')
        firstFigure.parentNode.appendChild(firstFigure)
      , 300)

  init: =>
    if @polaroidContainer
      @clearPolaroids()
      @stackPolaroids()
      @bindPolaroidClick()
